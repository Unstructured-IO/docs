- For the [Unstructured UI](/ui/overview) or the [Unstructured API](/api-reference/overview), local OpenSearch instances are not supported.
- For [Unstructured Ingest](/open-source/ingestion/overview), local and non-local OpenSearch instances are supported.

  For example, to set up an [Amazon OpenSearch Service managed cluster](https://docs.aws.amazon.com/opensearch-service/latest/developerguide/createupdatedomains.html) instance, complete steps similar to the following:
  
  1. Sign in to your AWS account, and then open your AWS Management Console.
  2. Open your Amazon OpenSearch Service console.
  3. On the sidebar, expand **Managed clusters**, and then click **Dashboard**.
  4. Click **Create domain**. 
  5. In the **Name** tile, for **Domain name**, enter some unique domain name for your new OpenSearch instance.
  6. In the **Domain creation method** tile, select a method for creating the domain. For faster setup with sensible 
     default settings, this example uses the **Easy create** method. 
     [Learn more about the Standard create method](https://docs.aws.amazon.com/opensearch-service/latest/developerguide/createupdatedomains.html).
  7. In the **Engine options** tile, for **Version**, AWS recommends that you select the latest version.
  8. In the **Network** tile, for **Network**, select a network access method. 
     For faster setup, this example uses the **Public access** method. 
     [Learn more about the VPC access method](https://docs.aws.amazon.com/opensearch-service/latest/developerguide/vpc.html#prerequisites-vpc-endpoints). 
  9. **For IP address type**, select **Dual-stack mode**.
  10. In the **Fine-grained access control** tile, do one of the following:
  
      - If you want to use an existing AWS IAM user in the AWS account as the domain's master user, then for **Master user**, select **Set IAM ARN as master user**. Then enter the IAM ARN for the master user in the **IAM ARN** box.
      - If you want to create a master user and password as the domain's master user instead, then for **Master user**, select **Create master user**. Then specify some username and password for this 
        new master user by filling in the **Master username**, **Master password**, and **Confirm master password** fields. Make 
        sure to save the master user's password in a secure location.

  12. Click **Create**.
  13. After the domain is created, you must allow Unstructured to access the domain, as follows:

      a. If the new domain's settings page is not already showing, open it as follows: 
         in your Amazon Open Search Service console, on the sidebar, expand **Managed clusters**, and then click **Domains**. Then, 
         in the list of available domains, click the name of the newly created domain.<br/>
      b. On the **Security configuration** tab, click **Edit**.<br/>
      c. In the **Access policy** tile, for **Domain access policy**, select **Only use fine-grained access control**.<br/>
      d. Click **Clear policy**.<br/>
      e. Click **Save changes**.

  To set up an [Amazon OpenSearch Serverless collection](https://docs.aws.amazon.com/opensearch-service/latest/developerguide/serverless-create-console.html), complete steps similar to the following:

  1. Sign in to your AWS account, and then open your AWS Management Console.
  2. Open your Amazon OpenSearch Service console.
  3. On the sidebar, expand **Serverless**, and then click **Dashboard**.
  4. Click **Create collection**.
  5. In the **Collection details** tile, for **Collection name**, enter some unique name for your new OpenSearch Serverless collection. 
     Optionally, for **Description**, enter some meaningful description for your new collection.
  6. For **Collection type**, select **Search**.

     <Note>
       Unstructured does not support the **Vector search** collection type. If you need vector search support, you can either continue 
       with these steps to use the **Search** collection type, or you can follow the preceding steps to set up set up an Amazon OpenSearch Service managed cluster instead. 
       However, note that vector search capabilities are less optimal for either of these options.
     </Note>

  7. In the **Collection creation method** tile, select **Standard create**.
  8. For **Encryption**, choose an AWS KMS key type.
  9. For **Network access settings**, choose an **Access type**.
  10. For **Resource type**, select both **Enable access to OpenSearch endpoint** and **Enable access to OpenSearch Dashboards**.
  11. Click **Next**.
  12. In the **Definition method** tile, select **JSON**.
  13. In the **JSON editor** box, enter the following JSON, replacing the following placeholders:
  
      - Replace `<collection-name>` with the name of the new OpenSearch Serverless collection.
      - Replace `<account-id>` with the target AWS account ID.
      - Replace `<user-id>` with the ID of the target AWS IAM user.

      ```json
      [
          {
              "Rules": [
                  {
                      "Resource": ["collection/<collection-name>"],
                      "Permission": [
                          "aoss:CreateCollectionItems",
                          "aoss:UpdateCollectionItems",
                          "aoss:DescribeCollectionItems"
                      ],
                      "ResourceType": "collection"
                  },
                  {
                      "Resource": ["index/<collection-name>/*"],
                      "Permission": [
                          "aoss:CreateIndex",
                          "aoss:DescribeIndex",
                          "aoss:ReadDocument",
                          "aoss:WriteDocument",
                          "aoss:UpdateIndex",
                          "aoss:DeleteIndex"
                      ],
                      "ResourceType": "index"
                  },
                  {
                      "Resource": ["model/<collection-name>/*"],
                      "Permission": [
                          "aoss:DescribeMLResource",
                          "aoss:CreateMLResource",
                          "aoss:UpdateMLResource",
                          "aoss:DeleteMLResource",
                          "aoss:ExecuteMLResource"
                      ],
                      "ResourceType": "model"
                  }
              ],
              "Principal": ["arn:aws:iam::<account-id>:user/<user-id>"]
          }
      ]
      ```

  14. Click **Next**.
  15. For **Data access policy settings**, select **Create as a new data access policy**.
  16. In the **Name and description** tile, enter some unique name and an optional description for the new data access policy.
  17. Click **Next**.
  18. Enter any desired index details, and click **Next** again. For example:

      a. For **Index name**, enter the name of the new index in the collection.<br/>
      b. For **Automatic Semantic Enrichment fields**, click **Add**, enter `embeddings` for **Automatic Semantic Enrichment field name**, click **Add**, and click ***Confirm**.<br/>
      c. For **Lexical search fields**, click **Add**, enter `text` for **Field name** and select **Text** for **Data type**, click **Add**, and click ***Confirm**.<br/>

  19. Click **Submit**.

  The following video shows how to set up a [local OpenSearch](https://opensearch.org/downloads.html) instance.

  <iframe
  width="560"
  height="315"
  src="https://www.youtube.com/embed/Rew3_pNnYIs"
  title="YouTube video player"
  frameborder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
  allowfullscreen
  ></iframe>

- The instance's host URL, as follows:

  - For an Amazon OpenSearch Service instance, do the following:

    1. Sign in to your AWS account, and then open your AWS Management Console.
    2. Open your Amazon OpenSearch Service console.
    3. On the sidebar, expand **Managed clusters**, and then click **Dashboard**.
    4. In the list of available domains, click the name of your domain.
    5. In the **General information** tile, copy the value of **Domain endpoint v2 (dual stack)**.

  - For an Amazon OpenSearch Serverless collection, do the following:
  
    1. Sign in to your AWS account, and then open your AWS Management Console.
    2. Open your Amazon OpenSearch Service console.
    3. On the sidebar, expand **Serverless**, and then click **Dashboard**.
    4. In the list of available collections, click the name of your collection.
    5. On the **Overview** tab, in the **Endpoint** tile, copy the value of **OpenSearch endpoint**.

  - For a local OpenSearch instance, see [Communicate with OpenSearch](https://opensearch.org/docs/latest/getting-started/communicate/).

- The name of the search index on the instance. 

  For the destination connector, if you need to create an index and you're using a master user and password as the domain's master user, you can use for example the following `curl` command. Replace the following placeholders:

  - Replace `<host>` with the instance's host URL.
  - Replace `<port>` with the instance's port number, which is typically `443` (for encrypted connections, and less commonly `9200` for unencrypted connections).
  - Replace `<master-username>` with the master user's name, and replace `<master-password>` with the master user's password.
  - Replace `<index-name>` with the name of the new search index on the instance.
  - Replace `<index-schema>` with the schema for the new search index on the instance. A schema is optional; see the explanation 
    following this `curl` command for more information.
  
  ```bash
  curl --request PUT "<host>:<port>/<index-name>" \
  --user "<master-username>:<master-password>" \
  [--header "Content-Type: application/json" \
  --data '<index-schema>']
  ```

  If you're using an existing AWS IAM user as the domain's master user instead, you should use the AWS Command Line Interface (CLI) to create the index instead of using the preceding`curl` command. To learn how, see [create-index](https://docs.aws.amazon.com/cli/latest/reference/opensearch/create-index.html) in the AWS CLI Command Reference.

  For the destination connector, the index does not need to contain a schema beforehand. If Unstructured encounters an index without a schema, 
  Unstructured will automatically create a compatible schema for you before inserting items into the index. Nonetheless, 
  to reduce possible schema compatibility issues, Unstructured recommends that you create a schema that is compatible with Unstructured's schema. 
  Unstructured cannot provide a schema that is guaranteed to work in all 
  circumstances. This is because these schemas will vary based on your source files' types; how you 
  want Unstructured to partition, chunk, and generate embeddings; any custom post-processing code that you run; and other factors. 

  For objects in the `metadata` field that Unstructured produces and that you want to store in an OpenSearch index, you must create fields in your index's schema that 
  follows Unstructured's `metadata` field naming convention. For example, if Unstructured produces a `metadata` field with the following 
  child objects:

  ```json
  "metadata": {
    "is_extracted": "true",
    "coordinates": {
      "points": [
        [
          134.20055555555555,
          241.36027777777795
        ],
        [
          134.20055555555555,
          420.0269444444447
        ],
        [
          529.7005555555555,
          420.0269444444447
        ],
        [
          529.7005555555555,
          241.36027777777795
        ]
      ],
      "system": "PixelSpace",
      "layout_width": 1654,
      "layout_height": 2339
    },
    "filetype": "application/pdf",
    "languages": [
      "eng"
    ],
    "page_number": 1,
    "image_mime_type": "image/jpeg",
    "filename": "realestate.pdf",
    "data_source": {
      "url": "file:///home/etl/node/downloads/00000000-0000-0000-0000-000000000001/7458635f-realestate.pdf",
      "record_locator": {
        "protocol": "file",
        "remote_file_path": "file:///home/etl/node/downloads/00000000-0000-0000-0000-000000000001/7458635f-realestate.pdf"
      }
    },
    "entities": {
      "items": [
        {
          "entity": "HOME FOR FUTURE",
          "type": "ORGANIZATION"
        },
        {
          "entity": "221 Queen Street, Melbourne VIC 3000",
          "type": "LOCATION"
        }
      ],
      "relationships": [
        {
          "from": "HOME FOR FUTURE",
          "relationship": "based_in",
          "to": "221 Queen Street, Melbourne VIC 3000"
        }
      ]
    }
  }
  ```

  You can adapt the following index schema example for your own needs. Note that outside of `metadata`, the following fields are 
  required by Unstructured whenever you create your own index schema:

  - `element_id`
  - `record_id`, which is required by Unstructured for intelligent record updates.
  - `type`, which is not required, but highly recommended.
  - `text`
  - `embeddings` if embeddings are generated; make sure to set `dimension` to the same number of dimensions as the embedding model generates.

  ```json
  {
    "settings": {
      "index": {
        "knn": true,
        "knn.algo_param.ef_search": 100
      }
    },
    "mappings": {
      "properties": {
        "element_id": {
          "type": "keyword"
        },
        "record_id": {
          "type": "text"
        },
        "text": {
          "type": "text"
        },
        "type": {
          "type": "text",
          "fields": {
            "keyword": {
              "type": "keyword",
              "ignore_above": 256
            }
          }
        },
        "embeddings": {
          "type": "knn_vector",
          "dimension": 1536
        },
        "metadata": {
          "properties": {
            "is_extracted": {
              "type": "boolean"
            },
            "coordinates-points": {
              "type": "float"
            },
            "coordinates-system": {
              "type": "text",
              "fields": {
                "keyword": {
                  "type": "keyword",
                  "ignore_above": 256
                }
              }
            },
            "coordinates-layout_width": {
              "type": "long"
            },
            "coordinates-layout_height": {
              "type": "long"
            },
            "filetype": {
              "type": "keyword"
            },
            "languages": {
              "type": "keyword"
            },
            "page_number": {
              "type": "integer"
            },
            "image_mime_type": {
              "type": "keyword"
            },
            "filename": {
              "type": "keyword"
            },
            "data_source-url": {
              "type": "keyword"
            },
            "data_source-record_locator-protocol": {
              "type": "keyword"
            },
            "data_source-record_locator-remote_file_path": {
              "type": "keyword"
            },
            "entities-items": {
              "properties": {
                "entity": {
                  "type": "text",
                  "fields": {
                    "keyword": {
                      "type": "keyword",
                      "ignore_above": 256
                    }
                  }
                },
                "type": {
                  "type": "text",
                  "fields": {
                    "keyword": {
                      "type": "keyword",
                      "ignore_above": 256
                    }
                  }
                }
              }
            },
            "entities-relationships": {
              "properties": {
                "from": {
                  "type": "text",
                  "fields": {
                    "keyword": {
                      "type": "keyword",
                      "ignore_above": 256
                    }
                  }
                },
                "relationship": {
                  "type": "text",
                  "fields": {
                    "keyword": {
                      "type": "keyword",
                      "ignore_above": 256
                    }
                  }
                },
                "to": {
                  "type": "text",
                  "fields": {
                    "keyword": {
                      "type": "keyword",
                      "ignore_above": 256
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
  ```

  See also: 

  - [Create an index](https://opensearch.org/docs/latest/api-reference/index-apis/create-index/)
  - [Mappings and field types](https://opensearch.org/docs/latest/field-types/)
  - [Explicit mapping](https://opensearch.org/docs/latest/field-types/#explicit-mapping)
  - [Dynamic mapping](https://opensearch.org/docs/latest/field-types/#dynamic-mapping)
  - [Unstructured document elements and metadata](/api-reference/partition/document-elements)

- For non-local OpenSearch instances, or if you're using basic authentication to a local OpenSearch instance, the master user's name and password.
- For local OpenSearch instances, if you're using certificates for authentication instead of basic authentication:

  - The path to the Certificate Authority (CA) bundle, if you use intermediate CAs with your root CA.
  - The path to the combined private key and certificate file, or
  - The paths to the separate private key and certificate file. 

  To learn more, see [Authentication backends](https://opensearch.org/docs/latest/security/authentication-backends/authc-index/), [HTTP basic authentication](https://opensearch.org/docs/latest/security/authentication-backends/basic-authc/), and [Client certificate authentication](https://opensearch.org/docs/latest/security/authentication-backends/client-auth/).



