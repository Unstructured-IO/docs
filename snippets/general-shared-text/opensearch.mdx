- For the [Unstructured UI](/ui/overview) or the [Unstructured API](/api-reference/overview), local OpenSearch instances are not supported.
- For [Unstructured Ingest](/open-source/ingestion/overview), local and non-local OpenSearch instances are supported.

  For example, to set up [OpenSearch in IBM watsonx.data](https://cloud.ibm.com/docs/watsonxdata?topic=watsonxdata-gs_opensearch), do the following:

  1. Create an [IBM Cloud account](https://cloud.ibm.com/registration), if you do not already have one.
  2. Create an IBM watsonx.data [Lite plan](https://cloud.ibm.com/docs/watsonxdata?topic=watsonxdata-tutorial_prov_lite_1) 
     or [Enterprise plan](https://cloud.ibm.com/docs/watsonxdata?topic=watsonxdata-getting-started_1), if you do not already have one, 
     within your IBM Cloud account.
  3. Open your IBM watsonx.data resource, if it is not already open.<br/>
  4. On the sidebar, click **Infrastructure manager**.<br/>
  5. Click **Add component**.<br/>
  6. Under **Engines**, click **OpenSearch**, and then click **Next**.<br/>
  7. Complete the on-screen instructions to finish creating the OpenSearch service instance.<br/>

  To set up an [AWS OpenSearch Service](https://docs.aws.amazon.com/opensearch-service/latest/developerguide/createupdatedomains.html) instance, complete steps similar to the following:
  
  1. Sign in to your AWS account, and then open your AWS Management Console.
  2. Open your Amazon OpenSearch Service console.
  3. On the sidebar, expand **Managed clusters**, and then click **Dashboard**.
  4. Click **Create domain**. 
  5. In the **Name** tile, for **Domain name**, enter some unique domain name for your new OpenSearch instance.
  6. In the **Domain creation method** tile, select a method for creating the domain. For faster setup with sensible 
     default settings, this example uses the **Easy create** method. 
     [Learn more about the Standard create method](https://docs.aws.amazon.com/opensearch-service/latest/developerguide/createupdatedomains.html).
  7. In the **Engine options** tile, for **Version**, AWS recommends that you select the latest version.
  8. In the **Network** tile, for **Network**, select a network access method. 
     For faster setup, this example uses the **Public access** method. 
     [Learn more about the VPC access method](https://docs.aws.amazon.com/opensearch-service/latest/developerguide/vpc.html#prerequisites-vpc-endpoints). 
  9. **For IP address type**, select **Dual-stack mode**.
  10. In the **Fine-grained access control** tile, do one of the following:
  
      - If you want to use an existing AWS IAM user in the AWS account as the domain's master user, then for **Master user**, select **Set IAM ARN as master user**. Then enter the IAM ARN for the master user in the **IAM ARN** box.
      - If you want to create a master user and password as the domain's master user instead, then for **Master user**, select **Create master user**. Then specify some username and password for this 
        new master user by filling in the **Master username**, **Master password**, and **Confirm master password** fields. Make 
        sure to save the master user's password in a secure location.

  12. Click **Create**.
  13. After the domain is created, you must allow Unstructured to access the domain, as follows:

      a. If the new domain's settings page is not already showing, open it as follows: 
         in your Amazon Open Search Service console, on the sidebar, expand **Managed clusters**, and then click **Domains**. Then, 
         in the list of available domains, click the name of the newly created domain.<br/>
      b. On the **Security configuration** tab, click **Edit**.<br/>
      c. In the **Access policy** tile, for **Domain access policy**, select **Only use fine-grained access control**.<br/>
      d. Click **Clear policy**.<br/>
      e. Click **Save changes**.

  The following video shows how to set up a [local OpenSearch](https://opensearch.org/downloads.html) instance.

  <iframe
  width="560"
  height="315"
  src="https://www.youtube.com/embed/Rew3_pNnYIs"
  title="YouTube video player"
  frameborder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
  allowfullscreen
  ></iframe>

- The instance's host identifier and port number, as follows:

  - For OpenSearch in IBM watsonx.data, do the following:

    1. Sign in to your IBM Cloud account, and then open the IBM watsonx.data resource in which the OpenSearch service instance is located.
    2. On the sidebar, click **Infrastructure manager**.
    3. Click the target OpenSearch service instance.
    4. On the **Details** tab, note the value of **HTTPS host**, which should have a a format similar to `https://<instance-id>.lakehouse.ibmappdomain.cloud:<port>`.

  - For an AWS OpenSearch Service instance, do the following:

    1. Sign in to your AWS account, and then open your AWS Management Console.
    2. Open your Amazon OpenSearch Service console.
    3. On the sidebar, expand **Managed clusters**, and then click **Dashboard**.
    4. In the list of available domains, click the name of your domain.
    5. In the **General information** tile, copy the value of **Domain endpoint v2 (dual stack)**.

  - For a local OpenSearch instance, see [Communicate with OpenSearch](https://opensearch.org/docs/latest/getting-started/communicate/).

- The name of the search index on the instance. 

  For the destination connector, if you need to create an index and you're using a master user and password as the domain's master user, you can use for example the following `curl` command. Replace the following placeholders:

  - Replace `<host>` with the instance's host identifier.
  - Replace `<port>` with the instance's port number.
  - Replace `<master-username>` with the master user's name, and replace `<master-password>` with the master user's password.
  - Replace `<index-name>` with the name of the new search index on the instance.
  - Replace `<index-schema>` with the schema for the new search index on the instance. A schema is optional; see the explanation 
    following this `curl` command for more information.
  
  ```bash
  curl --request PUT "<host>:<port>/<index-name>" \
  --user "<master-username>:<master-password>" \
  [--header "Content-Type: application/json" \
  --data '<index-schema>']
  ```

  If you're using OpenSearch in IBM watsonx.data, `<master-username>` is typically `ibmlhapikey_<your-IBMid>`, where `<your-IBMid>` is your IBMid, for example `me@example.com`; and 
  `<master-password>` is the IBM Cloud user API key for your IBM Cloud account.
  
  To get your IBMid, do the following:

  1. Sign in to your IBM Cloud account.
  2. In the title bar, click **Manage** and then, under **Security and access**, click **Access (IAM)**.
  3. On the sidebar, expand **Manage identities**, and then click **Users**.
  4. In the list of users, click your user name.
  5. On the **User details** tab, in the **Details** tile, note the value of **IBMid**.
  
  To get your IBM Cloud user API key, do the following:

  1. Sign in to your IBM Cloud account.
  2. In the title bar, click **Manage** and then, under **Security and access**, click **Access (IAM)**.
  3. On the sidebar, under **Manage identities**, click **API keys**. If the sidebar is not visible, click the **Navigation Menu** icon to the far left of the title bar.
  4. Click **Create**.
  5. Enter some **Name** for the API key.
  6. Optionally, enter some **Description** for the API key.
  7. For **Leaked action**, leave **Disable the leaked key** selected.
  8. For **Session management**, leave **No** selected.
  9. Click **Create**.
  10. Click **Copy** or **Download** to copy or save the API key to a secure location. You won't be able to access this API key from this screen again. If you lose this API key, you can create a new one (and you should then delete the old one).
  
  If you're using the AWS OpenSearch Service and an existing AWS IAM user as the domain's master user instead, you should use the AWS Command Line Interface (CLI) to create the index instead of using the preceding`curl` command. To learn how, see [create-index](https://docs.aws.amazon.com/cli/latest/reference/opensearch/create-index.html) in the AWS CLI Command Reference.

  For the destination connector, the index does not need to contain a schema beforehand. If Unstructured encounters an index without a schema, 
  Unstructured will automatically create a compatible schema for you before inserting items into the index. Nonetheless, 
  to reduce possible schema compatibility issues, Unstructured recommends that you create a schema that is compatible with Unstructured's schema. 
  Unstructured cannot provide a schema that is guaranteed to work in all 
  circumstances. This is because these schemas will vary based on your source files' types; how you 
  want Unstructured to partition, chunk, and generate embeddings; any custom post-processing code that you run; and other factors. 

  For objects in the `metadata` field that Unstructured produces and that you want to store in an OpenSearch index, you must create fields in your index's schema that 
  follows Unstructured's `metadata` field naming convention. For example, if Unstructured produces a `metadata` field with the following 
  child objects:

  ```json
  "metadata": {
    "is_extracted": "true",
    "coordinates": {
      "points": [
        [
          134.20055555555555,
          241.36027777777795
        ],
        [
          134.20055555555555,
          420.0269444444447
        ],
        [
          529.7005555555555,
          420.0269444444447
        ],
        [
          529.7005555555555,
          241.36027777777795
        ]
      ],
      "system": "PixelSpace",
      "layout_width": 1654,
      "layout_height": 2339
    },
    "filetype": "application/pdf",
    "languages": [
      "eng"
    ],
    "page_number": 1,
    "image_mime_type": "image/jpeg",
    "filename": "realestate.pdf",
    "data_source": {
      "url": "file:///home/etl/node/downloads/00000000-0000-0000-0000-000000000001/7458635f-realestate.pdf",
      "record_locator": {
        "protocol": "file",
        "remote_file_path": "file:///home/etl/node/downloads/00000000-0000-0000-0000-000000000001/7458635f-realestate.pdf"
      }
    },
    "entities": {
      "items": [
        {
          "entity": "HOME FOR FUTURE",
          "type": "ORGANIZATION"
        },
        {
          "entity": "221 Queen Street, Melbourne VIC 3000",
          "type": "LOCATION"
        }
      ],
      "relationships": [
        {
          "from": "HOME FOR FUTURE",
          "relationship": "based_in",
          "to": "221 Queen Street, Melbourne VIC 3000"
        }
      ]
    }
  }
  ```

  You can adapt the following index schema example for your own needs. Note that outside of `metadata`, the following fields are 
  required by Unstructured whenever you create your own index schema:

  - `element_id`
  - `record_id`, which is required by Unstructured for intelligent record updates.
  - `type`, which is not required, but highly recommended.
  - `text`
  - `embeddings` if embeddings are generated; make sure to set `dimension` to the same number of dimensions as the embedding model generates.

  ```json
  {
    "settings": {
      "index": {
        "knn": true,
        "knn.algo_param.ef_search": 100
      }
    },
    "mappings": {
      "properties": {
        "element_id": {
          "type": "keyword"
        },
        "record_id": {
          "type": "text"
        },
        "text": {
          "type": "text"
        },
        "type": {
          "type": "text",
          "fields": {
            "keyword": {
              "type": "keyword",
              "ignore_above": 256
            }
          }
        },
        "embeddings": {
          "type": "knn_vector",
          "dimension": 1536
        },
        "metadata": {
          "properties": {
            "is_extracted": {
              "type": "boolean"
            },
            "coordinates-points": {
              "type": "float"
            },
            "coordinates-system": {
              "type": "text",
              "fields": {
                "keyword": {
                  "type": "keyword",
                  "ignore_above": 256
                }
              }
            },
            "coordinates-layout_width": {
              "type": "long"
            },
            "coordinates-layout_height": {
              "type": "long"
            },
            "filetype": {
              "type": "keyword"
            },
            "languages": {
              "type": "keyword"
            },
            "page_number": {
              "type": "integer"
            },
            "image_mime_type": {
              "type": "keyword"
            },
            "filename": {
              "type": "keyword"
            },
            "data_source-url": {
              "type": "keyword"
            },
            "data_source-record_locator-protocol": {
              "type": "keyword"
            },
            "data_source-record_locator-remote_file_path": {
              "type": "keyword"
            },
            "entities-items": {
              "properties": {
                "entity": {
                  "type": "text",
                  "fields": {
                    "keyword": {
                      "type": "keyword",
                      "ignore_above": 256
                    }
                  }
                },
                "type": {
                  "type": "text",
                  "fields": {
                    "keyword": {
                      "type": "keyword",
                      "ignore_above": 256
                    }
                  }
                }
              }
            },
            "entities-relationships": {
              "properties": {
                "from": {
                  "type": "text",
                  "fields": {
                    "keyword": {
                      "type": "keyword",
                      "ignore_above": 256
                    }
                  }
                },
                "relationship": {
                  "type": "text",
                  "fields": {
                    "keyword": {
                      "type": "keyword",
                      "ignore_above": 256
                    }
                  }
                },
                "to": {
                  "type": "text",
                  "fields": {
                    "keyword": {
                      "type": "keyword",
                      "ignore_above": 256
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
  ```

  For OpenSearch in IBM watsonx.data, in the preceding index schema example, the `embeddings` field might need to be adjusted similar to the following, 
  making sure that `dimension` is set to the same number of dimensions as the embedding model generates:
  
  ```json
  "embeddings": {
    "type": "knn_vector",
    "dimension": 384,
    "space_type": "l2",
    "method": {
      "name": "hnsw",
      "engine": "lucene",
      "parameters": {
        "ef_construction": 128,
        "m": 24
      }
    }
  }
  ```

  See also: 

  - [Create an index](https://opensearch.org/docs/latest/api-reference/index-apis/create-index/)
  - [Mappings and field types](https://opensearch.org/docs/latest/field-types/)
  - [Explicit mapping](https://opensearch.org/docs/latest/field-types/#explicit-mapping)
  - [Dynamic mapping](https://opensearch.org/docs/latest/field-types/#dynamic-mapping)
  - [Unstructured document elements and metadata](/api-reference/partition/document-elements)

- For non-local OpenSearch instances, or if you're using basic authentication to a local OpenSearch instance, the master user's name and password.

  - For OpenSearch in IBM watsonx.data, the master user's name and password are the same as the IBMid and IBM Cloud user API key for your IBM Cloud account, respectively. To get 
    these values, see the procedures earlier in this article.
  - For an AWS OpenSearch Service instance, the master user's name and password were specified when the instance was created.

- For local OpenSearch instances, if you're using certificates for authentication instead of basic authentication:

  - The path to the Certificate Authority (CA) bundle, if you use intermediate CAs with your root CA.
  - The path to the combined private key and certificate file, or
  - The paths to the separate private key and certificate file. 

  To learn more, see [Authentication backends](https://opensearch.org/docs/latest/security/authentication-backends/authc-index/), [HTTP basic authentication](https://opensearch.org/docs/latest/security/authentication-backends/basic-authc/), and [Client certificate authentication](https://opensearch.org/docs/latest/security/authentication-backends/client-auth/).



