---
title: MCP
---

The Unstructured API enables you to ... 

The Unstructured API is compatible with the Model Context Protocol (MCP). 
MCP enables you to ... 
The MCP SDK ...

This article provides a hands-on, step-by-step walkthrough to build a simple example on your local development machine 
that integrates the Unstructured API with the MCP SDK. This walkthrough demonstrates how to create an MCP server that uses the 
Unstructured API's Workflow Endpoint to list all of your source connectors. You call this MCP server from Claude for Desktop, a chat-based interface, by 
by issuing commands that you write in plain language.

At the end of this walkthrough, you can extend this example to use the Workflow Endpoint to perform other tasks, such as creating, listing, changing, and 
deleting various connectors, workflows, and jobs in your Unstructured account.

## Requirements

Before you can start coding on your local machine, you must install the Python package and project manager `uv`, 
create and initialize a project directory for your code, create a virtual environment to isolate and manage your 
project's code and its dependencies, and install the MCP SDK and its dependencies, as follows.

These steps are also covered in the [Quickstart For Server Developers](https://modelcontextprotocol.io/quickstart/server) in the 
MCP documentation.

1. Install `uv` [Read the uv documentation](https://docs.astral.sh/uv/).

  By using `pip`:

  ```bash
  pip install uv
  ```

  Or, by using the following script (be sure to restart your terminal or Command Prompt after running the script):

  ```bash
  # For macOS and Linux:
  curl -LsSf https://astral.sh/uv/install.sh | sh

  # For Windows:
  powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"
  ```

2. From your current working directory, create a project directory and then initialize it. This example creates a 
   project directory named `mcp-unstructured-demo`. Then go to the project directory:

   ```bash
   uv init mcp-unstructured-demo
   cd mcp-unstructured-demo
   ```

3. Create a virtual environment in the root of the project directory. Then activate the virtual environment:

   ```bash
   # For macOS and Linux:
   uv venv
   source .venv/bin/activate

   # For Windows:
   uv venv
   .venv\Scripts\activate
   ```

   To deactivate and exit the virtual environment at any time, simply run the `deactivate` command:

   ```bash
   deactivate
   ```

4. With the virtual environment activated, install the MCP SDK and its dependencies:

  ```bash
  uv add "mcp[cli]" "unstructured-client>=0.30.6" dotenv anthropic
  ```

5. [Install Claude for Desktop](https://claude.ai/download).

## Step 1: Create the MCP server

1. In the root of the project directory, create a new Python file. This example names the file `workflow.py`.
2. Add the following code to this new `workflow.py` file:

   ```python
   from typing import Any, AsyncIterator, Optional
   from mcp.server.fastmcp import FastMCP, Context
   from dotenv import load_dotenv
   import os
   from dataclasses import dataclass
   from contextlib import asynccontextmanager
   from unstructured_client import UnstructuredClient
   from unstructured_client.models.operations import ListSourcesRequest
   from unstructured_client.models.shared import SourceConnectorType

   def load_environment_variables() -> None:
       load_dotenv()
       required_vars = [
           "UNSTRUCTURED_API_KEY"
       ]

       for var in required_vars:
           if not os.getenv(var):
               raise ValueError(f"Missing required environment variable: {var}")

   @dataclass
   class AppContext:
       client: UnstructuredClient

   @asynccontextmanager
   async def app_lifespan(server: FastMCP) -> AsyncIterator[AppContext]:
       api_key = os.getenv("UNSTRUCTURED_API_KEY")
       if not api_key:
           raise ValueError("UNSTRUCTURED_API_KEY environment variable is required")
       client = UnstructuredClient(api_key_auth=api_key)
       try:
           yield AppContext(client=client)
       finally:
           pass

   mcp = FastMCP("workflow", lifespan=app_lifespan)

   @mcp.tool()
   async def list_sources(ctx: Context, source_type: Optional[str] = None) -> str:
       client = ctx.request_context.lifespan_context.client
       request = ListSourcesRequest()

       if source_type:
           try:
               request.source_type = SourceConnectorType[source_type]
           except KeyError:
               return f"Invalid source type: {source_type}"

       response = await client.sources.list_sources_async(
           request=request
       )
       sorted_sources = sorted(
           response.response_list_sources, 
           key=lambda source: source.name.lower()
       )
       result = ["Available source connectors:"]

       for source in sorted_sources:
           result.append(f"- {source.name} (ID: {source.id})")

       return "\n".join(result)
       
   if __name__ == "__main__":
       load_environment_variables()
       mcp.run(transport='stdio')
   ```

3. In the root of the project directory, create a new file named `.env`.
4. Add the following code to this new `.env` file, replacing `<your-unstructured-api-key>` with your Unstructured API key:

   ```text
    UNSTRUCTURED_API_KEY=<your-unstructured-api-key>
   ```

5. Open the Claude for Desktop App configuration file from the following location, for example by using Visual Studio Code:

   ```text
   # For macOS or Linux:
   code ~/Library/Application\ Support/Claude/claude_desktop_config.json

   # For Windows:
   code $env:AppData\Claude\claude_desktop_config.json
   ```

6. Add the following code to the `claude_desktop_config.json` file, and then save the file.

   In this file:

   - `"worklow"` must match the value that you set in `mcp = FastMCP("workflow", lifespan=app_lifespan)` in the `workflow.py` file.
   - `mcp_unstructured-demo` must match the name of the project directory that you created.
   - `"workflow.py"` must match the name of the Python file that you created for the MCP server.

   For macOS or Linux:

   ```json
   {
       "mcpServers": {
           "workflow": {
               "command": "/ABSOLUTE/PATH/TO/uv",
               "args": [
                   "--directory",
                   "/ABSOLUTE/PATH/TO/PARENT/FOLDER/mcp-unstructured-demo",
                   "run",
                   "workflow.py"
               ]
           }
       }
   }
   ```

   For Windows:

   ```json
   {
       "mcpServers": {
           "workflow": {
               "command": "C:\\ABSOLUTE\\PATH\\TO\\uv",
               "args": [
                   "--directory",
                   "C:\\ABSOLUTE\\PATH\\TO\\PARENT\\FOLDER\\mcp-unstructured-demo",
                   "run",
                   "workflow.py"
               ]
           }
       }
   }
   ```

## Step 2: Run the MCP server and call it from Claude for Desktop

1. Start the MCP server by running the following command from the root of the project directory:

   ```bash
   uv run workflow.py
   ```

   The MCP server starts and begins listening for commands from Claude for Desktop.

2. Start Claude for Desktop. If it is already running, restart it.
3. Ask the following question in the chat window, replacing `S3` with the type of source connector that you want to list. 
   For a list of available source connector types, see the [Workflow Endpoint Sources overview](/api-reference/workflow/sources/overview).

   ```text
   List all available source connectors of type S3.
   ```

4. Claude for Desktop responds with a list of all available source connectors for that source connector type.
